# Sky Monitor SDK 测试报告

## 测试环境

-   **SDK 版本**: 1.0.0-demo
-   **浏览器**: Chrome 120+ / Firefox 120+ / Safari 17+
-   **后端版本**: 1.0.0
-   **测试日期**: 2024-XX-XX
-   **测试人**: ****\_\_\_****

## 测试覆盖

### Integration 测试 (11个，45个测试场景)

| Integration      | 测试场景数 | 通过/总计 | 状态 | 备注                                         |
| ---------------- | ---------- | --------- | ---- | -------------------------------------------- |
| 1. Errors        | 8          | ⬜ / 8    | ⏸️   | 同步/异步/Promise/引用/类型/自定义/资源/去重 |
| 2. Metrics       | 4          | ⬜ / 4    | ⏸️   | LCP/FCP/CLS/TTFB                             |
| 3. Session       | 6          | ⬜ / 6    | ⏸️   | 创建/持久化/超时/可见性/卸载/指标累加        |
| 4. HttpError     | 9          | ⬜ / 9    | ⏸️   | Fetch/XHR 404/500/超时/取消/脱敏/去重        |
| 5. ResourceError | 6          | ⬜ / 6    | ⏸️   | img/script/link/video/audio/去重             |
| 6. Performance   | 6          | ⬜ / 6    | ⏸️   | 快速/慢速/失败/并发/XHR/Fetch                |
| 7. Sampling      | 3          | ⬜ / 3    | ⏸️   | 错误采样/性能采样/元数据                     |
| 8. Deduplication | 3          | ⬜ / 3    | ⏸️   | 窗口内去重/计数/窗口过期                     |

**Integration 测试小计**: ⬜ / 45 通过

### 手动功能测试 (2个，9个测试场景)

| 功能             | 测试场景数 | 通过/总计 | 状态 | 备注                             |
| ---------------- | ---------- | --------- | ---- | -------------------------------- |
| 9. Breadcrumb    | 5          | ⬜ / 5    | ⏸️   | 点击/API/导航/附加/限制          |
| 10. User Context | 4          | ⬜ / 4    | ⏸️   | setUser/setTag/setExtra/全局附加 |

**手动功能小计**: ⬜ / 9 通过

### 传输功能测试 (2个，7个测试场景)

| 功能         | 测试场景数 | 通过/总计 | 状态 | 备注                       |
| ------------ | ---------- | --------- | ---- | -------------------------- |
| 11. Batching | 3          | ⬜ / 3    | ⏸️   | 批量触发/批次大小/刷新间隔 |
| 12. Offline  | 4          | ⬜ / 4    | ⏸️   | 网络断开/存储/限制/重试    |

**传输功能小计**: ⬜ / 7 通过

### SourceMap 测试 (1个，4个测试场景)

| 功能          | 测试场景数 | 通过/总计 | 状态 | 备注                    |
| ------------- | ---------- | --------- | ---- | ----------------------- |
| 13. SourceMap | 4          | ⬜ / 4    | ⏸️   | 配置/触发/上传/状态查询 |

**SourceMap 测试小计**: ⬜ / 4 通过

---

**总计**: ⬜ / 65 通过

**成功率**: \_\_\_%

## 数据验证

### ClickHouse 存储验证

-   [ ] 所有事件类型正确存储
-   [ ] 字段映射正确
-   [ ] JSON 字段正确序列化
-   [ ] 时间戳格式正确
-   [ ] 设备信息完整
-   [ ] 会话信息关联正确

### 事件分布统计

```sql
SELECT event_type, COUNT(*) as count
FROM monitor_events
WHERE app_id = 'demo_app_001'
GROUP BY event_type;
```

| 事件类型    | 预期数量 | 实际数量 | 状态 |
| ----------- | -------- | -------- | ---- |
| error       | >= 30    | **\_**   | ⏸️   |
| webVital    | >= 4     | **\_**   | ⏸️   |
| performance | >= 10    | **\_**   | ⏸️   |

### 会话数据验证

```sql
SELECT
    session_id,
    session_event_count,
    session_error_count,
    COUNT(*) as actual_events
FROM monitor_events
WHERE app_id = 'demo_app_001'
GROUP BY session_id, session_event_count, session_error_count;
```

-   [ ] Session ID 一致性
-   [ ] Event Count 累加正确
-   [ ] Error Count 累加正确

### SourceMap 解析验证

```sql
SELECT COUNT(*) as queued_jobs
FROM sourcemap_parse_queue
WHERE app_id = 'demo_app_001';
```

-   [ ] SourceMap 上传成功
-   [ ] 解析队列触发
-   [ ] 解析状态正确

## 问题记录

### 遇到的问题

| 问题编号 | 问题描述 | 影响范围 | 解决方案 | 状态 |
| -------- | -------- | -------- | -------- | ---- |
| 1        |          |          |          |      |
| 2        |          |          |          |      |
| 3        |          |          |          |      |

### 改进建议

1. ***
2. ***
3. ***

## 性能指标

### 前端性能

-   **SDK 初始化时间**: **\_** ms
-   **平均事件捕获延迟**: **\_** ms
-   **批量上报频率**: 符合配置 (20条/5秒) [ ]

### 后端性能

-   **单个事件处理时间**: **\_** ms
-   **批量事件处理时间**: **\_** ms
-   **ClickHouse 写入延迟**: **\_** ms

### 资源占用

-   **SDK 包大小**: **\_** KB
-   **内存占用**: **\_** MB
-   **CPU 占用**: **\_**%

## 测试结论

### 功能完整性

-   [ ] 所有 Integration 正常工作
-   [ ] 手动功能正确执行
-   [ ] 批量和离线机制正常
-   [ ] SourceMap 解析成功

### 数据准确性

-   [ ] 错误信息完整
-   [ ] 性能数据准确
-   [ ] 用户上下文正确附加
-   [ ] 会话追踪准确

### 系统稳定性

-   [ ] 无内存泄漏
-   [ ] 无性能瓶颈
-   [ ] 错误处理健壮
-   [ ] 降级策略正常

### 总体评价

-   **测试完成度**: **\_**%
-   **功能可用性**: ⭐⭐⭐⭐⭐ (\_/5)
-   **系统稳定性**: ⭐⭐⭐⭐⭐ (\_/5)
-   **文档完整性**: ⭐⭐⭐⭐⭐ (\_/5)

### 是否通过验收

-   [ ] ✅ 通过 - 可以投入生产使用
-   [ ] ⚠️ 有条件通过 - 需要修复小问题
-   [ ] ❌ 不通过 - 需要重大改进

## 签字确认

**测试人**: ******\_****** **日期**: ****\_\_\_****

**审核人**: ******\_****** **日期**: ****\_\_\_****

---

## 附录

### 测试环境配置

```javascript
// SDK 配置
{
    dsn: 'http://localhost:8080/api/monitoring/demo_app_001',
    appId: 'demo_app_001',
    release: '1.0.0-demo',
    environment: 'development',
    enableBatching: true,
    batchSize: 20,
    flushInterval: 5000,
    enableOffline: true,
    offlineQueueSize: 50,
    retryInterval: 10000,
    sampleRate: 1.0,
}
```

### 测试数据统计

-   **总测试时间**: **\_** 分钟
-   **总触发事件数**: **\_**
-   **总上报事件数**: **\_**
-   **去重过滤事件数**: **\_**
-   **采样过滤事件数**: **\_**
